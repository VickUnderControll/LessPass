<!-- File: `src/main/resources/templates/register.html` -->
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg,#667eea,#764ba2); height:100vh; margin:0; display:flex; justify-content:center; align-items:center; }
        .card { background:white; padding:2.2rem; border-radius:18px; box-shadow:0 10px 25px rgba(0,0,0,0.2); width:420px; }
        h2 { text-align:center; margin-top:0; color:#333; }
        .input-group { margin-bottom:1rem; }
        label { display:block; font-size:.9rem; margin-bottom:.35rem; color:#555; }
        input { width:100%; padding:.7rem; border-radius:10px; border:1px solid #ddd; font-size:1rem; box-sizing:border-box; }
        .btn { width:100%; padding:.85rem; background:#667eea; color:#fff; border:none; border-radius:10px; font-size:1rem; cursor:pointer; margin-top:.5rem; }
        .link-row { margin-top:.8rem; text-align:center; color:#555; }
        .link-row a { color:#667eea; text-decoration:none; font-weight:600; }

        /* modal popup */
        .modal-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.5); display:flex; align-items:center; justify-content:center; z-index:50; opacity:0; pointer-events:none; transition:opacity .15s ease; }
        .modal { background:white; padding:1.25rem 1.5rem; border-radius:12px; width:340px; box-shadow:0 8px 30px rgba(0,0,0,0.3); text-align:left; }
        .modal h3 { margin:0 0 .5rem 0; color:#333; }
        .modal p { margin:0 0 .75rem 0; color:#444; }
        .modal .close { display:inline-block; padding:.4rem .7rem; background:#667eea; color:#fff; border-radius:8px; cursor:pointer; border:none; }
        .modal-backdrop.show { opacity:1; pointer-events:auto; }
    </style>
</head>
<body>
<div class="card">
    <h2>Crear cuenta</h2>
    <form th:action="@{/register}" method="post" id="registerForm">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <div class="input-group">
            <label for="username">Usuario</label>
            <input type="text" id="username" name="username" placeholder="Usuario" required autofocus>
        </div>

        <div class="input-group">
            <label for="password">Contraseña</label>
            <input type="password" id="password" name="password" placeholder="Contraseña" required>
        </div>

        <button type="submit" class="btn">Registrar</button>
    </form>

    <div class="link-row">
        ¿Ya tienes cuenta? <a th:href="@{/login}" href="/login">Inicia sesión</a>
    </div>
</div>

<!-- Modal popup -->
<div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-hidden="true">
    <div class="modal" role="document">
        <h3 id="modalTitle">Aviso</h3>
        <p id="modalMessage">Mensaje</p>
        <div style="text-align:right;">
            <button id="modalClose" class="close">Cerrar</button>
        </div>
    </div>
</div>

<script>
    (function() {
        const params = new URLSearchParams(window.location.search);
        const backdrop = document.getElementById('modalBackdrop');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const modalClose = document.getElementById('modalClose');
        const form = document.getElementById('registerForm');

        function openModal(t, m) {
            modalTitle.textContent = t;
            modalMessage.textContent = m;
            backdrop.classList.add('show');
            backdrop.setAttribute('aria-hidden', 'false');
        }

        function closeModal() {
            backdrop.classList.remove('show');
            backdrop.setAttribute('aria-hidden', 'true');
            if (window.history && window.history.replaceState) {
                const url = new URL(window.location);
                url.search = '';
                window.history.replaceState({}, document.title, url.toString());
            }
        }

        modalClose.addEventListener('click', closeModal);
        backdrop.addEventListener('click', function(e) { if (e.target === backdrop) closeModal(); });

        // Mensajes según parámetros: el backend debe enviar ?registered, ?error, ?userExists, ?logout
        if (params.has('registered')) {
            openModal('Registro correcto', 'Cuenta creada correctamente. Ya puedes iniciar sesión.');
        } else if (params.has('userExists')) {
            openModal('Usuario existente', 'El nombre de usuario ya está en uso. Elige otro.');
        } else if (params.has('error')) {
            openModal('Error al registrar', 'Ha ocurrido un error al crear la cuenta.');
        } else if (params.has('logout')) {
            openModal('Sesión cerrada', 'Has cerrado sesión correctamente.');
        }

        // Validación mínima en cliente: evitar enviar sin usuario/contraseña
        form.addEventListener('submit', function(e) {
            const u = document.getElementById('username').value.trim();
            const p = document.getElementById('password').value;
            if (!u || !p) {
                e.preventDefault();
                openModal('Formulario incompleto', 'Rellena usuario y contraseña antes de registrar.');
            }
        });
    })();
</script>
</body>
</html>
